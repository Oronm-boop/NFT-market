# EasySwap NFT 交易市场（基于 Ethereum Sepolia）

**2025-10 ~ 2026-02 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; 项目负责人**

**项目背景：** 基于链上订单簿模型，独立完成 NFT 交易市场的全链路开发。项目覆盖智能合约、链下索引、后端 API 和前端四层架构，核心突破点在于**自研链下事件索引服务**，解决了区块链数据无法高效查询的核心痛点，实现链上事件到结构化数据库的实时同步与聚合计算。

**链下索引服务设计：**
- **区块轮询与事件解码引擎：** 基于 Go 实现 RPC 轮询循环，以 100 区块为批次批量拉取合约事件日志，通过事件签名哈希路由到对应的处理器（订单创建 / 订单成交 / 订单取消 / NFT 授权），利用 ABI 解码还原链上订单结构体，实现事件的精确解析与分类处理。
- **多表联动的数据同步策略：** 单次事件触发多表级联写入——以挂单事件为例，一笔挂单同时写入订单表（订单状态）、NFT 表（挂单价格与元数据）、活动记录表（交易历史），并触发集合聚合更新（地板价、交易量），通过 GORM 事务保证数据一致性。
- **区块链分叉检测与自动回滚：** 实现分叉检测机制，通过比对交易哈希与区块高度检测链重组，自动回滚受影响的订单状态（已成交 → 活跃、已取消 → 活跃）、恢复 NFT 所有权记录并清除脏活动数据，保障 8 个区块确认窗口内的数据最终一致性。
- **地板价实时维护与历史追踪：** 通过定时任务查询各集合最低活跃挂单价并更新集合地板价，同步写入价格变动表记录价格趋势，并自动清理 30 天前的历史数据。

**智能合约层：**
- **链上订单簿交易模型：** 设计订单簿 + 金库双合约架构，订单簿合约负责订单创建/撮合/取消逻辑，金库合约负责 NFT 和 ETH 的安全托管，通过权限修饰器实现调用权限隔离，仅允许订单簿合约操作金库资产。
- **红黑树价格排序：** 在链上利用红黑树实现 O(log n) 的价格排序存储，支持固定价格挂单、单品出价、集合出价三种订单类型。

**技术栈：** Go · Gin · GORM · Solidity · Hardhat · Next.js · TypeScript · wagmi · ethers.js · MySQL · Redis · go-ethereum
